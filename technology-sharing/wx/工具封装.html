<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>微信小程序万能工具 | LeeWei</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="时光荏苒，不容辜负">
    <link rel="preload" href="/assets/css/0.styles.3d861c3a.css" as="style"><link rel="preload" href="/assets/js/app.fb4b594f.js" as="script"><link rel="preload" href="/assets/js/2.6867dc6a.js" as="script"><link rel="preload" href="/assets/js/90.ff62a5c8.js" as="script"><link rel="prefetch" href="/assets/js/10.a7033795.js"><link rel="prefetch" href="/assets/js/11.5d81a733.js"><link rel="prefetch" href="/assets/js/12.027b01f6.js"><link rel="prefetch" href="/assets/js/13.ea1599b2.js"><link rel="prefetch" href="/assets/js/14.c09f7fc4.js"><link rel="prefetch" href="/assets/js/15.b7c76547.js"><link rel="prefetch" href="/assets/js/16.0360e20b.js"><link rel="prefetch" href="/assets/js/17.3de75350.js"><link rel="prefetch" href="/assets/js/18.9c15207f.js"><link rel="prefetch" href="/assets/js/19.a734cb3d.js"><link rel="prefetch" href="/assets/js/20.16db8362.js"><link rel="prefetch" href="/assets/js/21.c2f1cf0c.js"><link rel="prefetch" href="/assets/js/22.af4d76a0.js"><link rel="prefetch" href="/assets/js/23.14bcc91b.js"><link rel="prefetch" href="/assets/js/24.34ed309b.js"><link rel="prefetch" href="/assets/js/25.fa16ade6.js"><link rel="prefetch" href="/assets/js/26.ab4af1da.js"><link rel="prefetch" href="/assets/js/27.f992d58f.js"><link rel="prefetch" href="/assets/js/28.4a4967a4.js"><link rel="prefetch" href="/assets/js/29.cde723e8.js"><link rel="prefetch" href="/assets/js/3.52e436ac.js"><link rel="prefetch" href="/assets/js/30.037b2797.js"><link rel="prefetch" href="/assets/js/31.59f110e1.js"><link rel="prefetch" href="/assets/js/32.e72c04b0.js"><link rel="prefetch" href="/assets/js/33.607e5ddd.js"><link rel="prefetch" href="/assets/js/34.4c522971.js"><link rel="prefetch" href="/assets/js/35.689d4b7e.js"><link rel="prefetch" href="/assets/js/36.61c86b75.js"><link rel="prefetch" href="/assets/js/37.087049a7.js"><link rel="prefetch" href="/assets/js/38.0846fe14.js"><link rel="prefetch" href="/assets/js/39.7e5f5636.js"><link rel="prefetch" href="/assets/js/4.ce56291f.js"><link rel="prefetch" href="/assets/js/40.1ad29da8.js"><link rel="prefetch" href="/assets/js/41.2ecf6e91.js"><link rel="prefetch" href="/assets/js/42.278ce735.js"><link rel="prefetch" href="/assets/js/43.2e760387.js"><link rel="prefetch" href="/assets/js/44.78d3cd28.js"><link rel="prefetch" href="/assets/js/45.9951e16a.js"><link rel="prefetch" href="/assets/js/46.142e160d.js"><link rel="prefetch" href="/assets/js/47.d68d2c9f.js"><link rel="prefetch" href="/assets/js/48.60fbba0c.js"><link rel="prefetch" href="/assets/js/49.0ffc473a.js"><link rel="prefetch" href="/assets/js/5.14cd14b8.js"><link rel="prefetch" href="/assets/js/50.61c868bf.js"><link rel="prefetch" href="/assets/js/51.f86d356a.js"><link rel="prefetch" href="/assets/js/52.9dfd9c08.js"><link rel="prefetch" href="/assets/js/53.230324d3.js"><link rel="prefetch" href="/assets/js/54.0581d8f1.js"><link rel="prefetch" href="/assets/js/55.501f109b.js"><link rel="prefetch" href="/assets/js/56.632735fb.js"><link rel="prefetch" href="/assets/js/57.5c79fc75.js"><link rel="prefetch" href="/assets/js/58.48bd76a4.js"><link rel="prefetch" href="/assets/js/59.735f454d.js"><link rel="prefetch" href="/assets/js/6.2a995e5d.js"><link rel="prefetch" href="/assets/js/60.cc770f81.js"><link rel="prefetch" href="/assets/js/61.c1655391.js"><link rel="prefetch" href="/assets/js/62.c4cad089.js"><link rel="prefetch" href="/assets/js/63.16d14f42.js"><link rel="prefetch" href="/assets/js/64.063f2937.js"><link rel="prefetch" href="/assets/js/65.8c9caa9c.js"><link rel="prefetch" href="/assets/js/66.022f1a04.js"><link rel="prefetch" href="/assets/js/67.59fd26db.js"><link rel="prefetch" href="/assets/js/68.af5429c4.js"><link rel="prefetch" href="/assets/js/69.c1642887.js"><link rel="prefetch" href="/assets/js/7.a5a750fb.js"><link rel="prefetch" href="/assets/js/70.3e544813.js"><link rel="prefetch" href="/assets/js/71.e29ed7da.js"><link rel="prefetch" href="/assets/js/72.d83e424f.js"><link rel="prefetch" href="/assets/js/73.6cb65b3b.js"><link rel="prefetch" href="/assets/js/74.86c8dce0.js"><link rel="prefetch" href="/assets/js/75.b38d285d.js"><link rel="prefetch" href="/assets/js/76.f97ec681.js"><link rel="prefetch" href="/assets/js/77.355bf772.js"><link rel="prefetch" href="/assets/js/78.0c8e102a.js"><link rel="prefetch" href="/assets/js/79.d033a040.js"><link rel="prefetch" href="/assets/js/8.d9fec83f.js"><link rel="prefetch" href="/assets/js/80.0d8e40a6.js"><link rel="prefetch" href="/assets/js/81.4f0b09a7.js"><link rel="prefetch" href="/assets/js/82.68c45544.js"><link rel="prefetch" href="/assets/js/83.7171d504.js"><link rel="prefetch" href="/assets/js/84.63d85f45.js"><link rel="prefetch" href="/assets/js/85.fff19a5e.js"><link rel="prefetch" href="/assets/js/86.8a198622.js"><link rel="prefetch" href="/assets/js/87.a753fb97.js"><link rel="prefetch" href="/assets/js/88.7b97d8b1.js"><link rel="prefetch" href="/assets/js/89.185a21b5.js"><link rel="prefetch" href="/assets/js/9.a1c6328b.js"><link rel="prefetch" href="/assets/js/91.2d2cec18.js"><link rel="prefetch" href="/assets/js/92.3867c925.js"><link rel="prefetch" href="/assets/js/93.d6db9bf0.js"><link rel="prefetch" href="/assets/js/94.13598048.js"><link rel="prefetch" href="/assets/js/95.45bb57f7.js"><link rel="prefetch" href="/assets/js/96.efcca59a.js"><link rel="prefetch" href="/assets/js/97.1ebf4ca2.js"><link rel="prefetch" href="/assets/js/98.83ca56c6.js"><link rel="prefetch" href="/assets/js/99.458871ea.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3d861c3a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/headLogo.png" alt="LeeWei" class="logo"> <span class="site-name can-hide">LeeWei</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/technology-sharing/html+css/" class="nav-link">
  html+css
</a></li><li class="dropdown-item"><!----> <a href="/technology-sharing/js/" class="nav-link">
  js基础入门
</a></li><li class="dropdown-item"><!----> <a href="/technology-sharing/jquery/" class="nav-link">
  jquery
</a></li><li class="dropdown-item"><!----> <a href="/technology-sharing/es6/" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/technology-sharing/vue/" class="nav-link">
  全面拥抱Vue
</a></li><li class="dropdown-item"><!----> <a href="/technology-sharing/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/technology-sharing/TypeScript/" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/technology-sharing/wx/" class="nav-link router-link-active">
  微信小程序
</a></li><li class="dropdown-item"><!----> <a href="/technology-sharing/node/" class="nav-link">
  node.js
</a></li><li class="dropdown-item"><!----> <a href="/technology-sharing/webpack/" class="nav-link">
  webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/technology-sharing/php/" class="nav-link">
  php
</a></li><li class="dropdown-item"><!----> <a href="/technology-sharing/JAVA/" class="nav-link">
  JAVA
</a></li></ul></div></div><div class="nav-item"><a href="/technology-sharing/jsDir/" class="nav-link">
  js公共方法
</a></div><div class="nav-item"><a href="/technology-sharing/bigData/" class="nav-link">
  大数据
</a></div><div class="nav-item"><a href="/tools/" class="nav-link">
  实用工具
</a></div><div class="nav-item"><a href="/About/" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/technology-sharing/html+css/" class="nav-link">
  html+css
</a></li><li class="dropdown-item"><!----> <a href="/technology-sharing/js/" class="nav-link">
  js基础入门
</a></li><li class="dropdown-item"><!----> <a href="/technology-sharing/jquery/" class="nav-link">
  jquery
</a></li><li class="dropdown-item"><!----> <a href="/technology-sharing/es6/" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/technology-sharing/vue/" class="nav-link">
  全面拥抱Vue
</a></li><li class="dropdown-item"><!----> <a href="/technology-sharing/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/technology-sharing/TypeScript/" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/technology-sharing/wx/" class="nav-link router-link-active">
  微信小程序
</a></li><li class="dropdown-item"><!----> <a href="/technology-sharing/node/" class="nav-link">
  node.js
</a></li><li class="dropdown-item"><!----> <a href="/technology-sharing/webpack/" class="nav-link">
  webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/technology-sharing/php/" class="nav-link">
  php
</a></li><li class="dropdown-item"><!----> <a href="/technology-sharing/JAVA/" class="nav-link">
  JAVA
</a></li></ul></div></div><div class="nav-item"><a href="/technology-sharing/jsDir/" class="nav-link">
  js公共方法
</a></div><div class="nav-item"><a href="/technology-sharing/bigData/" class="nav-link">
  大数据
</a></div><div class="nav-item"><a href="/tools/" class="nav-link">
  实用工具
</a></div><div class="nav-item"><a href="/About/" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>微信小程序</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/technology-sharing/wx/" aria-current="page" class="sidebar-link">微信小程序开发</a></li><li><a href="/technology-sharing/wx/基础配置.html" class="sidebar-link">简单了解小程序</a></li><li><a href="/technology-sharing/wx/工具封装.html" class="active sidebar-link">微信小程序万能工具</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technology-sharing/wx/工具封装.html#微信小程序请求封装" class="sidebar-link">微信小程序请求封装</a></li><li class="sidebar-sub-header"><a href="/technology-sharing/wx/工具封装.html#格式化数据" class="sidebar-link">格式化数据</a></li><li class="sidebar-sub-header"><a href="/technology-sharing/wx/工具封装.html#格式化时间" class="sidebar-link">格式化时间</a></li><li class="sidebar-sub-header"><a href="/technology-sharing/wx/工具封装.html#添加缓存" class="sidebar-link">添加缓存</a></li><li class="sidebar-sub-header"><a href="/technology-sharing/wx/工具封装.html#获取缓存" class="sidebar-link">获取缓存</a></li><li class="sidebar-sub-header"><a href="/technology-sharing/wx/工具封装.html#显示加载" class="sidebar-link">显示加载</a></li><li class="sidebar-sub-header"><a href="/technology-sharing/wx/工具封装.html#隐藏加载" class="sidebar-link">隐藏加载</a></li><li class="sidebar-sub-header"><a href="/technology-sharing/wx/工具封装.html#检测是否登陆" class="sidebar-link">检测是否登陆</a></li><li class="sidebar-sub-header"><a href="/technology-sharing/wx/工具封装.html#发起登陆" class="sidebar-link">发起登陆</a></li><li class="sidebar-sub-header"><a href="/technology-sharing/wx/工具封装.html#转化小数精度丢失" class="sidebar-link">转化小数精度丢失</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technology-sharing/wx/工具封装.html#自动补小数点后两位" class="sidebar-link">自动补小数点后两位</a></li></ul></li></ul></li><li><a href="/technology-sharing/wx/微信小程序总结.html" class="sidebar-link">微信小程序总结</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="本章节分享一些关于微信小程序工具的封装"><a href="#本章节分享一些关于微信小程序工具的封装" class="header-anchor">#</a> 本章节分享一些关于微信小程序工具的封装</h3> <h2 id="微信小程序请求封装"><a href="#微信小程序请求封装" class="header-anchor">#</a> 微信小程序请求封装</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> serverPath <span class="token operator">=</span> <span class="token string">''</span>        <span class="token comment">//正式服务器地址</span>
<span class="token keyword">let</span> serverPathTrial <span class="token operator">=</span> <span class="token string">''</span>   <span class="token comment">//测试服务器地址</span>
<span class="token keyword">let</span> serverPathDev <span class="token operator">=</span> <span class="token string">''</span>     <span class="token comment">//开发服务器地址</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// eslint-disable-next-line no-undef</span>
<span class="token keyword">const</span> env <span class="token operator">=</span> __wxConfig<span class="token punctuation">.</span>envVersion
<span class="token comment">// 请求自己服务器</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> method <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 默认正式环境，如果非正式环境，则切换</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>env <span class="token operator">===</span> <span class="token string">'develop'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    serverPath <span class="token operator">=</span> serverPathDev
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>env <span class="token operator">===</span> <span class="token string">'trial'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    serverPath <span class="token operator">=</span> serverPathTrial
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      url<span class="token operator">:</span> serverPath <span class="token operator">+</span> url<span class="token punctuation">,</span>
      data<span class="token punctuation">,</span>
      method<span class="token operator">:</span> method <span class="token operator">||</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
      header<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'content-type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
        <span class="token string">'X-Token'</span><span class="token operator">:</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>token  <span class="token comment">//每次请求携带token 可以自行修改</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// config.headers['X-Requested-With'] = 'XMLHttpRequest'</span>
      <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>statusCode <span class="token operator">!==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'请求异常'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> res<span class="token punctuation">.</span>data
        <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">!==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 未登录</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">1002</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 重新登录</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'刚登录掉啦，请重试！'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// 其他异常码的处理</span>
          <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">fail</span><span class="token punctuation">(</span><span class="token parameter">ret</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 请求云服务, header 遵循wx.request 的规范，实际请求通常是headers</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">requestCloud</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token punctuation">,</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">'post'</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> weRunData <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// data.token = app.globalData.token</span>
  <span class="token comment">// data.expire = app.globalData.expire</span>
  header<span class="token punctuation">.</span>token <span class="token operator">=</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>token
  header<span class="token punctuation">.</span>expire <span class="token operator">=</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>expire
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">callFunction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">'service'</span><span class="token punctuation">,</span>
      data<span class="token operator">:</span> <span class="token punctuation">{</span> url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> method<span class="token punctuation">,</span> headers<span class="token operator">:</span> header<span class="token punctuation">,</span> weRunData <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> result<span class="token punctuation">.</span>result
        <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">!==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 未登录</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">1002</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 重新登录</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'你的登录掉啦，请先登录！'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// 其他异常码的处理</span>
          <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// new Error(res.data.message)\</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'调用异常'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br></div></div><h2 id="格式化数据"><a href="#格式化数据" class="header-anchor">#</a> 格式化数据</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token comment">/**
   * [格式化数据]
   * @param  {[type]} n [description]
   * @return {[type]}   [description]
   */</span>
  <span class="token function-variable function">formatNumber</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    n <span class="token operator">=</span> n<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">?</span> n <span class="token operator">:</span> <span class="token string">'0'</span> <span class="token operator">+</span> n
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="格式化时间"><a href="#格式化时间" class="header-anchor">#</a> 格式化时间</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token function-variable function">formatTime2</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">number<span class="token punctuation">,</span> format</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> formateArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Y'</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">,</span> <span class="token string">'h'</span><span class="token punctuation">,</span> <span class="token string">'m'</span><span class="token punctuation">,</span> <span class="token string">'s'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> returnArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// var date = new Date(number * 1000);</span>
    <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
    returnArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    returnArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">formatNumber</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    returnArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">formatNumber</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// returnArr.push(this.formatNumber(date.getHours()));</span>
    <span class="token comment">// returnArr.push(this.formatNumber(date.getMinutes()));</span>
    <span class="token comment">// returnArr.push(this.formatNumber(date.getSeconds()));</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> returnArr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      format <span class="token operator">=</span> format<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>formateArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> returnArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> format<span class="token punctuation">;</span>

  <span class="token punctuation">}</span>
  <span class="token comment">/**
   * [格式化时间]
   * @param  {[type]} date [description]
   * @return {[type]}      [description]
   */</span>
  <span class="token function-variable function">formatTime</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">date<span class="token punctuation">,</span> type<span class="token punctuation">,</span> fuhao</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> year <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> month <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">const</span> day <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> hour <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> minute <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> second <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">'date'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span>year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> day<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>formatNumber<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>fuhao<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">'time'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span>hour<span class="token punctuation">,</span> minute<span class="token punctuation">,</span> second<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>formatNumber<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> day<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>formatNumber<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>fuhao<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token punctuation">[</span>hour<span class="token punctuation">,</span> minute<span class="token punctuation">,</span> second<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>formatNumber<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>


  <span class="token function-variable function">formatPassTime</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">startTime</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> time <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> lastTime <span class="token operator">=</span> time <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
    <span class="token keyword">var</span> min <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>lastTime <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> sec <span class="token operator">=</span> lastTime <span class="token operator">-</span> min <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> minStr <span class="token operator">=</span> min <span class="token operator">&gt;=</span> <span class="token number">10</span> <span class="token operator">?</span> min <span class="token operator">:</span> <span class="token punctuation">(</span>min <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">'00'</span> <span class="token operator">:</span> <span class="token string">'0'</span> <span class="token operator">+</span> min<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> secStr <span class="token operator">=</span> sec <span class="token operator">&gt;=</span> <span class="token number">10</span> <span class="token operator">?</span> sec <span class="token operator">:</span> <span class="token punctuation">(</span>sec <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">'00'</span> <span class="token operator">:</span> <span class="token string">'0'</span> <span class="token operator">+</span> sec<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> minStr <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> secStr<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><h2 id="添加缓存"><a href="#添加缓存" class="header-anchor">#</a> 添加缓存</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token comment">// 添加缓存</span>
  <span class="token function-variable function">setStorageSync</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="获取缓存"><a href="#获取缓存" class="header-anchor">#</a> 获取缓存</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
  <span class="token comment">// 获取缓存</span>
  <span class="token function-variable function">getStorageSync</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="显示加载"><a href="#显示加载" class="header-anchor">#</a> 显示加载</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// showLoading 显示加载</span>
  <span class="token function-variable function">showLoading</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">title</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token punctuation">,</span>
      mask<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="隐藏加载"><a href="#隐藏加载" class="header-anchor">#</a> 隐藏加载</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token comment">// hideLoading 隐藏加载</span>
  <span class="token function-variable function">hideLoading</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="检测是否登陆"><a href="#检测是否登陆" class="header-anchor">#</a> 检测是否登陆</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token function-variable function">isLogin</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> apenid <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'apenid '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> this_ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> apenid <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> apenid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="发起登陆"><a href="#发起登陆" class="header-anchor">#</a> 发起登陆</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function-variable function">login</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> this_ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>this_<span class="token punctuation">.</span>isLoging<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    this_<span class="token punctuation">.</span>isLoging <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    this_<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">'去登录'</span><span class="token punctuation">)</span>
    wx<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">//发起网络请求</span>
          this_<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> response<span class="token punctuation">.</span>code<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> this_<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">'获取用户登录态失败！'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="转化小数精度丢失"><a href="#转化小数精度丢失" class="header-anchor">#</a> 转化小数精度丢失</h2> <ul><li>我们都知道在js 里面0.1+0.2缺不等于0.3的情况因为数字相加时采用二进制的在展示结果时才转化为十进制，当十进制小数的二进制表示的有限数字超过 52 位时，在 JavaScript 里是不能精确存储的，这时候就存在舍入误差(Round-off error)，这就造成了为什么0.1+0.2缺不为0.3的情况。</li> <li>这种问题怎样解决呢？市面上有许多的类库例如Math.js、decimal.js、 big.js等等 感兴趣的同学可以看看底层源码。但是最长用也最高效的做法是将相加的俩个数同时乘以100 或者1000 在相加最后在将得到的结果除100或者1000</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Math<span class="token punctuation">.</span>js
官网：http<span class="token operator">:</span><span class="token operator">/</span><span class="token regex">/mathjs.org/</span>
GitHub：https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>josdejong<span class="token operator">/</span>mathjs

decimal<span class="token punctuation">.</span>js
官网：http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mikemcl<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token operator">/</span>decimal<span class="token punctuation">.</span>js<span class="token operator">/</span>
GitHub：https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>MikeMcl<span class="token operator">/</span>decimal<span class="token punctuation">.</span>js

big<span class="token punctuation">.</span>js
官网：http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mikemcl<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token operator">/</span>big<span class="token punctuation">.</span>js
GitHub：https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>MikeMcl<span class="token operator">/</span>big<span class="token punctuation">.</span>js<span class="token operator">/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="自动补小数点后两位"><a href="#自动补小数点后两位" class="header-anchor">#</a> 自动补小数点后两位</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">formatNum</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> newStr <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> str<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> count <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                newStr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> newStr<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                newStr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> newStr<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            count<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        str <span class="token operator">=</span> newStr <span class="token operator">+</span> <span class="token string">&quot;.00&quot;</span><span class="token punctuation">;</span> <span class="token comment">//自动补小数点后两位</span>
        <span class="token keyword">return</span> str<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> count <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                newStr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> newStr<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                newStr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> newStr<span class="token punctuation">;</span> <span class="token comment">//逐个字符相接起来</span>
            <span class="token punctuation">}</span>
            count<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        str <span class="token operator">=</span> newStr <span class="token operator">+</span> <span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token string">&quot;00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token string">&quot;00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> str<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">25.60</span><span class="token punctuation">,</span> <span class="token number">11.36</span><span class="token punctuation">,</span> <span class="token number">0.02</span><span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.00</span><span class="token punctuation">]</span>
a1 <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">toatal<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">debugger</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>toatal<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>cur <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">formatNum</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/technology-sharing/wx/基础配置.html" class="prev">
        简单了解小程序
      </a></span> <span class="next"><a href="/technology-sharing/wx/微信小程序总结.html">
        微信小程序总结
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.fb4b594f.js" defer></script><script src="/assets/js/2.6867dc6a.js" defer></script><script src="/assets/js/90.ff62a5c8.js" defer></script>
  </body>
</html>
